<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astrobloom Interactive Globe</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIINfR7xP64jsImS44GdJqLsy7S+A8S53kU=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-200l2hLgL2N4m9D5s0qf0B8Z5D3k2p2s=" crossorigin=""></script>
    <style>
        body {
            margin: 0;
            background: #0d0d0d;
            font-family: 'Syne', sans-serif;
            color: #e5e7eb;
            overflow: hidden;
        }
        #mainContainer {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }
        @media (min-width: 768px) {
            #mainContainer {
                flex-direction: row;
            }
        }
        #globeViz {
            width: 100%;
            height: 50vh;
            cursor: grab;
        }
        @media (min-width: 768px) {
            #globeViz {
                width: 50%;
                height: 100%;
            }
        }
        #dataVizContainer {
            width: 100%;
            height: 50vh;
            padding: 2rem;
            overflow-y: auto;
            background: #1a1a1a;
        }
        @media (min-width: 768px) {
            #dataVizContainer {
                width: 50%;
                height: 100%;
            }
        }
        #sliderContainer {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: calc(50% - 40px);
            text-align: center;
            color: white;
            font-size: 1em;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
            z-index: 1000;
        }
        @media (max-width: 767px) {
            #sliderContainer {
                width: calc(100% - 40px);
                bottom: calc(50% + 20px);
                left: 20px;
                transform: translateY(-50%);
            }
        }
        input[type="range"] {
            width: 80%;
            -webkit-appearance: none;
            height: 8px;
            background: #d84594;
            outline: none;
            border-radius: 5px;
            margin-top: 10px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #ffc0cb;
            cursor: pointer;
            border-radius: 50%;
        }
        #playBtn {
            margin-top: 10px;
            padding: 8px 16px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 8px;
            border: none;
            background: #d84594;
            color: white;
            transition: background-color 0.2s;
        }
        #playBtn:hover {
            background-color: #ffc0cb;
            color: black;
        }
        #map {
            height: 300px;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease-in-out;
            margin-bottom: 1rem;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 1.5rem;
        }
        .chart-card {
            background-color: #0d0d0d;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .loader {
            border: 4px solid #333;
            border-top: 4px solid #d84594;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Scrollbar styles for modern browsers */
        #dataVizContainer::-webkit-scrollbar {
            width: 8px;
        }
        #dataVizContainer::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        #dataVizContainer::-webkit-scrollbar-thumb {
            background-color: #444;
            border-radius: 10px;
            border: 2px solid #1a1a1a;
        }
    </style>
</head>
<body>
    <div id="mainContainer">
        <div id="globeViz"></div>
        <div id="dataVizContainer" class="md:p-8 p-4">
            <h1 class="text-3xl md:text-4xl font-bold mb-4 text-[#ffc0cb]">AstroBloom: The Pulse of Life</h1>
            <div id="data-visualization-info" class="text-gray-400 mb-6">
                <p>Click a marker on the map or a button below to see its NDVI trend and prediction.</p>
            </div>
            
            <!-- Map container for Leaflet map -->
            <div id="map"></div>
            
            <div class="chart-card">
                <h3 class="text-lg font-semibold text-white/90 mb-2">NDVI Trend & Prediction</h3>
                <div id="chart-container-wrapper" class="chart-container flex justify-center items-center">
                    <canvas id="ndviChart" class="hidden"></canvas>
                    <div id="chart-status" class="text-gray-400">Loading chart...</div>
                </div>
            </div>
            <div id="ai-prediction-section" class="pt-6">
                <h3 class="text-2xl font-bold text-white/90 mb-2">AI Prediction</h3>
                <div id="ai-response-container" class="bg-black text-gray-300 p-4 rounded-lg shadow-inner min-h-[5rem]">
                    AI responses will appear here. Click a data point on the chart and then click "Get AI Prediction" for more info.
                </div>
                <div id="selected-month-info" class="mt-4 hidden">
                    <span class="text-white font-medium">Selected Month: </span><span id="selected-month-text" class="text-[#ffc0cb]"></span>
                    <button id="get-prediction-button" class="ml-4 bg-[#d84594] text-white py-1 px-3 rounded-full hover:bg-[#ffc0cb] hover:text-black transition-colors">Get AI Prediction</button>
                </div>
            </div>
            <div class="pt-6">
                <h3 class="text-xl font-semibold text-white/90 mb-4">Select a Country</h3>
                <div id="country-buttons-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-2 lg:grid-cols-3 gap-3"></div>
            </div>
            <div class="pt-6">
                <h3 class="text-2xl font-bold text-white/90 mb-2">Upload Data</h3>
                <div class="flex flex-col space-y-2">
                    <label for="hdf-file-input" class="block text-gray-400 font-medium">Upload a MODIS HDF file:</label>
                    <input type="file" id="hdf-file-input" accept=".hdf" class="block w-full text-sm text-gray-500
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-[#d84594] file:text-white
                        hover:file:bg-[#ffc0cb] hover:file:text-black transition-colors
                    ">
                    <p id="upload-status-message" class="text-sm text-gray-500 mt-2"></p>
                </div>
            </div>
        </div>
    </div>
    
    <div id="sliderContainer">
        <span id="monthLabel">January</span><br>
        <input type="range" id="monthSlider" min="0" max="11" step="1" value="0"><br>
        <button id="playBtn">▶ Play</button>
    </div>

    <script src="https://unpkg.com/three"></script>
    <script src="https://unpkg.com/globe.gl"></script>

    <script>
        // --- Global Variables ---
        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const bloomData = [];
        const locations = {
            "Japan": {"lat": 36.2048, "lon": 138.2529, "species": "Cherry Blossom - Sakura"},
            "Alaska": {"lat": 64.2008, "lon": -149.4937, "species": "Lupine and Arctic Poppy"},
            "Madagascar": {"lat": -18.7669, "lon": 46.8691, "species": "Baobab and Traveler's Palm"},
            "New Zealand": {"lat": -40.9006, "lon": 174.8860, "species": "Kōwhai and Pohutukawa"},
            "Fiji": {"lat": -17.7134, "lon": 178.0650, "species": "Hibiscus and Breadfruit"}
        };
        let currentLocation = 'Japan';
        let myChart;
        let selectedDataPointIndex = null;
        let fetchedNDVIData = {};

        // --- Data Generation ---
        function addBloom(lat, lng, month, info, count = 10, spread = 3) {
            for (let i = 0; i < count; i++) {
                bloomData.push({
                    lat: lat + (Math.random() - 0.5) * spread,
                    lng: lng + (Math.random() - 0.5) * spread,
                    month,
                    ...info
                });
            }
        }

        function generateNDVIDataForLocation(locationName, startDate, numMonths) {
            const dates = [];
            const ndvi = [];
            const start = new Date(startDate);
            let seasonalFactor, baseValue;
            switch(locationName) {
                case "Japan": baseValue = 0.45; seasonalFactor = 0.25; break;
                case "Alaska": baseValue = 0.2; seasonalFactor = 0.6; break;
                case "Madagascar": baseValue = 0.7; seasonalFactor = 0.08; break;
                case "New Zealand": baseValue = 0.5; seasonalFactor = 0.2; break;
                case "Fiji": baseValue = 0.8; seasonalFactor = 0.05; break;
                default: baseValue = 0.5; seasonalFactor = 0.2;
            }
            for (let i = 0; i < numMonths; i++) {
                const date = new Date(start.getFullYear(), start.getMonth() + i, 1);
                dates.push(date);
                let month = date.getMonth();
                // Southern hemisphere data adjustment
                if (locationName === "New Zealand" || locationName === "Madagascar" || locationName === "Fiji") {
                    month = (month + 6) % 12;
                }
                const value = baseValue + seasonalFactor * Math.sin(month * (Math.PI / 6)) + 0.03 * (Math.random() - 0.5);
                ndvi.push(Math.max(0, Math.min(1, value)));
            }
            return { dates, ndvi };
        }

        async function fetchDataAndLoad() {
            const ndviData = {};
            const numMonths = 60; // 5 years of data
            for (const loc in locations) {
                ndviData[loc] = generateNDVIDataForLocation(loc, '2020-01-01', numMonths);
            }
            return ndviData;
        }

        // --- Globe Visualization Logic ---
        const GlobeObj = Globe()
            .globeImageUrl('//unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
            .pointAltitude(d => 0.02 + 0.02 * Math.sin(Date.now() * 0.005 + d.lat))
            .pointRadius(0.4)
            .pointColor(d => d.color)
            .pointLabel(d => `<b>${d.label}</b><br><i>${d.species}</i><br>${d.note}`);

        const globeElement = document.getElementById('globeViz');
        GlobeObj(globeElement);
        // Make the renderer's background transparent to remove the black border
        GlobeObj.renderer().setClearAlpha(0);
        GlobeObj.controls().autoRotate = true;
        GlobeObj.controls().autoRotateSpeed = 0.2;

        function updateGlobe(monthIndex) {
            const label = document.getElementById("monthLabel");
            label.textContent = monthNames[monthIndex];
            const filtered = bloomData.filter(d => d.month === monthIndex);
            GlobeObj.pointsData(filtered);
        }

        function animateGlobePoints() {
            GlobeObj.pointAltitude(d => 0.02 + 0.02 * Math.sin(Date.now() * 0.005 + d.lat));
            requestAnimationFrame(animateGlobePoints);
        }

        // --- NDVI Chart & AI Logic ---
        function updateChart(locationName) {
            currentLocation = locationName;
            const chartData = fetchedNDVIData[locationName];
            if (!chartData) return;
            document.getElementById('ndviChart').classList.remove('hidden');
            document.getElementById('chart-status').style.display = 'none';

            // Calculate seasonal pattern for a more accurate prediction
            const monthlyAverages = new Array(12).fill(0);
            const monthlyCounts = new Array(12).fill(0);
            chartData.dates.forEach((date, i) => {
                const month = date.getMonth();
                monthlyAverages[month] += chartData.ndvi[i];
                monthlyCounts[month]++;
            });
            const seasonalPattern = monthlyAverages.map((sum, month) => sum / monthlyCounts[month]);

            // Simple linear trend for prediction
            const xMonths = Array.from({ length: chartData.dates.length }, (_, i) => i);
            const n = xMonths.length;
            const sumX = xMonths.reduce((a, b) => a + b, 0);
            const sumY = chartData.ndvi.reduce((a, b) => a + b, 0);
            const sumXY = xMonths.reduce((sum, x, i) => sum + x * chartData.ndvi[i], 0);
            const sumX2 = xMonths.reduce((sum, x) => sum + x * x, 0);
            const m = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const c = (sumY - m * sumX) / n;

            const futureDates = [];
            const predictedNDVI = [];
            const lastMonth = chartData.dates[chartData.dates.length - 1];
            for (let i = 1; i <= 12; i++) {
                const futureDate = new Date(lastMonth.getFullYear(), lastMonth.getMonth() + i, 1);
                const futureMonthIndex = futureDate.getMonth();
                const futureMonthTotalIndex = chartData.dates.length + i - 1;
                const prediction = c + m * futureMonthTotalIndex + (seasonalPattern[futureMonthIndex] - (c + m * futureMonthTotalIndex)); // Combine trend and seasonality
                predictedNDVI.push(Math.max(0, Math.min(1, prediction)));
                futureDates.push(futureDate);
            }

            const allDates = chartData.dates.concat(futureDates);
            const allNDVI = chartData.ndvi.concat(predictedNDVI);
            const lastHistoricalIndex = chartData.dates.length - 1;

            const ctx = document.getElementById('ndviChart').getContext('2d');
            if (myChart) { myChart.destroy(); }
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: allDates.map(d => d.toLocaleString('default', { month: 'short', year: 'numeric' })),
                    datasets: [
                        {
                            label: 'Historical NDVI',
                            data: chartData.ndvi,
                            borderColor: '#2ca02c',
                            backgroundColor: 'rgba(44, 160, 44, 0.2)',
                            pointBackgroundColor: '#2ca02c',
                            borderWidth: 2,
                            pointRadius: 3,
                            fill: false,
                            tension: 0.4
                        },
                        {
                            label: 'Predicted NDVI',
                            data: allNDVI,
                            borderColor: '#d84594',
                            backgroundColor: 'rgba(216, 69, 148, 0.2)',
                            pointBackgroundColor: '#d84594',
                            borderWidth: 2,
                            pointRadius: 3,
                            fill: false,
                            borderDash: [5, 5],
                            tension: 0.4,
                            pointStyle: (context) => {
                                const index = context.dataIndex;
                                if (index <= lastHistoricalIndex) { return 'circle'; } else { return 'star'; }
                            }
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: { display: true, text: 'Date', color: '#9ca3af' },
                            ticks: { color: '#9ca3af', autoSkip: true, maxTicksLimit: 12 },
                            grid: { color: 'rgba(156, 163, 175, 0.1)' }
                        },
                        y: {
                            title: { display: true, text: 'NDVI (Vegetation Index)', color: '#9ca3af' },
                            min: 0,
                            max: 1,
                            ticks: { color: '#9ca3af' },
                            grid: { color: 'rgba(156, 163, 175, 0.1)' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#e5e7eb' }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(31, 41, 55, 0.8)',
                            titleColor: '#e5e7eb',
                            bodyColor: '#9ca3af'
                        }
                    },
                    onClick: handleChartClick
                }
            });
            const infoPanel = document.getElementById('data-visualization-info');
            infoPanel.innerHTML = `<h3 class="text-xl font-semibold text-white/90 mb-2">${locationName}</h3><p class="text-gray-400">Click on a data point to get an AI prediction for that month.</p>`;
            document.getElementById('selected-month-info').classList.add('hidden');
        }

        function handleChartClick(event) {
            const points = myChart.getElementsAtEventForMode(event, 'nearest', { intersect: true }, true);
            if (points.length) {
                const firstPoint = points[0];
                const label = myChart.data.labels[firstPoint.index];
                selectedDataPointIndex = firstPoint.index;
                const selectedMonthInfo = document.getElementById('selected-month-info');
                const selectedMonthText = document.getElementById('selected-month-text');
                selectedMonthText.textContent = label;
                const getPredictionButton = document.getElementById('get-prediction-button');
                const isHistorical = firstPoint.datasetIndex === 0;
                getPredictionButton.textContent = isHistorical ? 'Get AI Analysis' : 'Get AI Prediction';
                selectedMonthInfo.classList.remove('hidden');
            }
        }

        function getPredictionForSelectedMonth() {
            if (selectedDataPointIndex === null) {
                document.getElementById('ai-response-container').textContent = "Please select a month on the chart first.";
                return;
            }
            const selectedMonth = myChart.data.labels[selectedDataPointIndex];
            const isHistorical = selectedDataPointIndex < myChart.data.datasets[0].data.length;
            const value = isHistorical 
                ? myChart.data.datasets[0].data[selectedDataPointIndex]
                : myChart.data.datasets[1].data[selectedDataPointIndex];
            const location = currentLocation;
            const species = locations[location].species;
            const type = isHistorical ? 'historical' : 'predicted';
            const prompt = `Based on the ${type} NDVI value of ${value.toFixed(2)} for ${selectedMonth} in ${location}, provide an analysis of the vegetation health. The prominent plant life there includes ${species}. Explain what this NDVI value might indicate about the plant growth, any potential environmental factors influencing it, and the overall state of the ecosystem for that period.`;
            getAIPrediction(prompt);
        }

        async function getAIPrediction(prompt) {
            const aiResponseContainer = document.getElementById('ai-response-container');
            aiResponseContainer.innerHTML = `<div class="loader mx-auto"></div> <span class="block text-center mt-2 text-gray-400">Thinking...</span>`;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: "Act as a world-class remote sensing and environmental data analyst. Provide a concise, single-paragraph summary explaining the vegetation health and factors influencing it for the requested location and time, based on the provided NDVI data." }],
                },
            };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }
                const result = await response.json();
                const candidate = result.candidates?.[0];
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    aiResponseContainer.textContent = candidate.content.parts[0].text;
                } else {
                    aiResponseContainer.textContent = "Sorry, I could not generate a prediction for that data. Please try again.";
                    console.error("API response was not in the expected format.");
                }
            } catch (error) {
                console.error("Error fetching AI prediction:", error);
                aiResponseContainer.textContent = "An error occurred while fetching the AI prediction. Please check your network connection and try again.";
            }
        }

        // --- Map and UI Interactions ---
        function initMap() {
            if (typeof L === 'undefined') { console.error("Leaflet.js not loaded. Map cannot be initialized."); return; }
            const map = L.map('map').setView([20, 0], 2);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);
            for (const loc in locations) {
                const coords = locations[loc];
                const marker = L.marker([coords.lat, coords.lon]).addTo(map);
                marker.bindPopup(loc);
                marker.on('click', () => { 
                    updateChart(loc);
                    // Fly the globe to the selected location
                    GlobeObj.pointOfView({ lat: coords.lat, lng: coords.lon, altitude: 2 }, 2000); 
                });
            }
        }

        function createCountryButtons() {
            const buttonContainer = document.getElementById('country-buttons-container');
            Object.keys(locations).forEach(loc => {
                const button = document.createElement('button');
                button.textContent = loc;
                button.className = 'bg-gray-800 text-gray-300 py-2 px-4 rounded-full transition-colors duration-200 hover:bg-[#d84594] hover:text-white focus:outline-none focus:ring-2 focus:ring-[#ffc0cb] focus:ring-opacity-50';
                button.addEventListener('click', () => { 
                    updateChart(loc); 
                    const coords = locations[loc];
                    GlobeObj.pointOfView({ lat: coords.lat, lng: coords.lon, altitude: 2 }, 2000); 
                });
                buttonContainer.appendChild(button);
            });
        }

        // --- Event Listeners and Initialization ---
        window.onload = async () => {
            const chartStatus = document.getElementById('chart-status');
            const hdfFileInput = document.getElementById('hdf-file-input');
            const uploadStatusMessage = document.getElementById('upload-status-message');
            const getPredictionButton = document.getElementById('get-prediction-button');
            const slider = document.getElementById("monthSlider");
            const playBtn = document.getElementById("playBtn");
            
            // Populate globe data
            ["#e8eb49ff", "#f5a2acff", "#f484d4ff", "#e647b9ff", "#ab8aecff", "#d56de3ff", "#e898ecff", "#f399f0ff", "#de4242ff", "#c27d37ff", "#e16473ff", "#f1ebb2ff"].forEach((color, i) => {
                addBloom(36.2, 138.2, i, {color, label: "Japan", species: "Cherry Blossom - Sakura", note: "Cultural symbol, peak bloom in spring; critical for pollinators."}, 15, 5);
            });
            ["#83b1ddff", "#649ac8ff", "#a2d7ecff", "#6a5acd", "#8f2da0ff", "#d25db9ff", "#cad239ff", "#d9eaa5ff", "#94dee1ff", "#5cabcaff", "#34879eff", "#4b6cb1ff"].forEach((color, i) => {
                addBloom(64.2, -149.5, i, {color, label: "Alaska", species: "Lupine and Arctic Poppy", note: "Short growing season; blooms support insects."}, 12, 6);
            });
            ["#2e7d32", "#4b9d4fff", "#6bc56fff", "#e1a2d6ff", "#8be0ddff", "#98d6e7ff", "#8ae5e5ff", "#9adbedff", "#c71585", "#edb232ff", "#e2b330ff", "#b288d1ff"].forEach((color, i) => {
                addBloom(-18.9, 47.5, i, {color, label: "Madagascar", species: "Baobab and Traveler's Palm", note: "Unique flora; blooms influence lemur feeding and pollination."}, 15, 5);
            });
            ["#ff1493", "#ff1493", "#ff8c00", "#b22222", "#b22222", "#778899", "#87ceeb", "#ffb6c1", "#ffff00", "#e3e54eff", "#cb84c9ff", "#b52212ff"].forEach((color, i) => {
                addBloom(-40.9, 174.9, i, {color, label: "New Zealand", species: "Kōwhai and Pohutukawa", note: "Seasonal shifts vital for native birds like tui and bellbirds."}, 15, 5);
            });
            ["#ebe41fff", "#efa3eeff", "#e28ee8ff", "#ef6caeff", "#ea9cd4ff", "#da48c2ff", "#ffffff", "#ff4500", "#ea8ecbff", "#edaa92ff", "#eea58bff", "#e69a87ff"].forEach((color, i) => {
                addBloom(-17.7, 178.1, i, {color, label: "Fiji", species: "Hibiscus and Breadfruit", note: "Blooms tied to rainfall cycles; important for pollinators and agriculture."}, 15, 5);
            });
            
            // Check for library loading
            if (typeof Chart === 'undefined' || typeof L === 'undefined' || typeof Globe === 'undefined') {
                chartStatus.innerHTML = "Error: A required library failed to load. Please try again.";
                return;
            }

            try {
                chartStatus.textContent = "Fetching data...";
                fetchedNDVIData = await fetchDataAndLoad();
                chartStatus.textContent = "Data loaded.";
            } catch (error) {
                chartStatus.textContent = "Failed to load data. Please check the console for errors.";
                console.error("Initialization error:", error);
            }

            // UI setup
            initMap();
            createCountryButtons();
            updateChart('Japan');
            updateGlobe(0);
            animateGlobePoints();

            // Event listeners
            if (getPredictionButton) { getPredictionButton.addEventListener('click', getPredictionForSelectedMonth); }
            slider.addEventListener("input", e => {
                updateGlobe(parseInt(e.target.value));
            });

            let isPlaying = false;
            let playInterval;
            playBtn.addEventListener("click", () => {
                if (!isPlaying) {
                    isPlaying = true;
                    playBtn.textContent = "⏸ Pause";
                    playInterval = setInterval(() => {
                        let nextMonth = (parseInt(slider.value) + 1) % 12;
                        slider.value = nextMonth;
                        updateGlobe(nextMonth);
                    }, 1000);
                } else {
                    isPlaying = false;
                    playBtn.textContent = "▶ Play";
                    clearInterval(playInterval);
                }
            });

            hdfFileInput.addEventListener('change', (event) => {
                if (event.target.files.length > 0) {
                    uploadStatusMessage.className = 'text-sm text-yellow-400 mt-2';
                    uploadStatusMessage.textContent = 'Processing file...';
                    setTimeout(() => {
                        uploadStatusMessage.className = 'text-sm text-green-400 mt-2';
                        uploadStatusMessage.textContent = 'File uploaded successfully. Simulating data visualization. Please select a location to see the updated chart.';
                        updateChart(currentLocation);
                    }, 2000);
                }
            });
        };
    </script>
</body>
</html>
