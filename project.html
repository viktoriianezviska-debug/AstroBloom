<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AstroBloom Interactive Globe</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://unpkg.com/three"></script>
<script src="https://unpkg.com/globe.gl"></script>
<style>
    body {
        margin: 0;
        font-family: 'Syne', sans-serif;
        background: #0d0d0d;
        color: #e5e7eb;
    }

    #mainContainer {
        display: flex;
        flex-direction: row;
        height: 100vh;
        width: 100vw;
    }

    #globeViz {
        flex: 1;
        background: transparent;
    }

    #dataVizContainer {
        flex: 1;
        padding: 2rem;
        overflow-y: auto;
        background: #111;
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .chart-card {
        background-color: #1a1a1a;
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }

    .chart-container {
        position: relative;
        height: 300px;
    }

    #map {
        height: 300px;
        border-radius: 1rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }

    #sliderContainer {
        position: absolute;
        bottom: 20px;
        left: 20px;
        width: 40%;
        text-align: center;
        color: white;
        font-size: 1.1rem;
        background: rgba(0,0,0,0.5);
        padding: 10px;
        border-radius: 10px;
    }

    input[type="range"] {
        width: 80%;
        -webkit-appearance: none;
        height: 8px;
        background: #d84594;
        outline: none;
        border-radius: 5px;
        margin-top: 10px;
    }

    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        background: #ffc0cb;
        border-radius: 50%;
        cursor: pointer;
    }

    #playBtn {
        margin-top: 10px;
        padding: 8px 16px;
        font-size: 1em;
        cursor: pointer;
        border-radius: 8px;
        border: none;
        background: #d84594;
        color: white;
    }

    .loader {
        border: 4px solid #333;
        border-top: 4px solid #d84594;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
</head>
<body>

<div id="mainContainer">
    <div id="globeViz"></div>
    <div id="dataVizContainer">
        <h1 class="text-4xl font-bold text-[#ffc0cb]">AstroBloom</h1>
        <p class="text-gray-400">Explore seasonal vegetation bloom around the world.</p>

        <div id="map"></div>

        <div class="chart-card">
            <h3 class="text-lg font-semibold text-white/90 mb-2">NDVI Trend & Prediction</h3>
            <div class="chart-container">
                <canvas id="ndviChart" class="hidden"></canvas>
                <div id="chart-status" class="text-gray-400">Loading chart...</div>
            </div>
        </div>

        <div class="chart-card">
            <h3 class="text-lg font-semibold text-white/90 mb-2">AI Prediction</h3>
            <div id="ai-response-container" class="bg-black text-gray-300 p-4 rounded-lg min-h-[5rem]">
                AI responses will appear here.
            </div>
            <div id="selected-month-info" class="mt-4 hidden">
                <span class="text-white font-medium">Selected Month: </span><span id="selected-month-text" class="text-[#ffc0cb]"></span>
                <button id="get-prediction-button" class="ml-4 bg-[#d84594] text-white py-1 px-3 rounded-full hover:bg-[#ffc0cb] hover:text-black transition-colors">Get AI Prediction</button>
            </div>
        </div>

        <div class="chart-card">
            <h3 class="text-lg font-semibold text-white/90 mb-2">Select a Country</h3>
            <div id="country-buttons-container" class="grid grid-cols-2 md:grid-cols-3 gap-3"></div>
        </div>
    </div>
</div>

<div id="sliderContainer">
    <span id="monthLabel">January</span><br>
    <input type="range" id="monthSlider" min="0" max="11" step="1" value="0"><br>
    <button id="playBtn">▶ Play</button>
</div>

<script>
    // --- Globe setup ---
    const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    const bloomData = [];

    function addBloom(lat, lng, month, info, count=10, spread=3) {
        for (let i=0;i<count;i++){
            bloomData.push({
                lat: lat + (Math.random()-0.5)*spread,
                lng: lng + (Math.random()-0.5)*spread,
                month,
                ...info
            });
        }
    }

    // Example bloom data for Japan
    ["#e8eb49ff","#f5a2acff","#f484d4ff","#e647b9ff","#ab8aecff","#d56de3ff","#e898ecff","#f399f0ff","#de4242ff","#c27d37ff","#e16473ff","#f1ebb2ff"].forEach((color,i)=>{
        addBloom(36.2,138.2,i,{color,label:"Japan",species:"Cherry Blossom - Sakura",note:"Peak bloom in spring."},15,5);
    });

    const GlobeObj = Globe()
        .globeImageUrl(null) // transparent globe
        .backgroundColor('rgba(0,0,0,0)') // transparent
        .pointAltitude(d => 0.02 + 0.02*Math.sin(Date.now()*0.005 + d.lat))
        .pointRadius(0.4)
        .pointColor(d => d.color)
        .pointLabel(d => `<b>${d.label}</b><br><i>${d.species}</i><br>${d.note}`);

    GlobeObj(document.getElementById('globeViz'));
    GlobeObj.controls().autoRotate = true;
    GlobeObj.controls().autoRotateSpeed = 0.2;

    const slider = document.getElementById("monthSlider");
    const label = document.getElementById("monthLabel");

    function updateGlobe(monthIndex){
        label.textContent = monthNames[monthIndex];
        const filtered = bloomData.filter(d => d.month === monthIndex);
        GlobeObj.pointsData(filtered);
    }

    updateGlobe(0);

    slider.addEventListener("input", e => updateGlobe(parseInt(e.target.value)));

    (function animate(){
        GlobeObj.pointAltitude(d => 0.02 + 0.02*Math.sin(Date.now()*0.005 + d.lat));
        requestAnimationFrame(animate);
    })();

    // Play button
    let isPlaying = false;
    let playInterval;
    const playBtn = document.getElementById("playBtn");
    playBtn.addEventListener("click", ()=>{
        if (!isPlaying){
            isPlaying = true;
            playBtn.textContent = "⏸ Pause";
            playInterval = setInterval(()=>{
                let nextMonth = (parseInt(slider.value)+1)%12;
                slider.value = nextMonth;
                updateGlobe(nextMonth);
            },1000);
        } else {
            isPlaying = false;
            playBtn.textContent = "▶ Play";
            clearInterval(playInterval);
        }
    });
</script>

</body>
</html>
