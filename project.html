<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AstroBloom Interactive Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fonts & Tailwind -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Libraries -->
  <script src="https://unpkg.com/three"></script>
  <script src="https://unpkg.com/globe.gl"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: 'Syne', sans-serif;
      background: #000;
      color: #f0a6ca; /* dark pink text */
      overflow: hidden;
    }
    #globeViz {
      width: 100%;
      height: 100%;
      background: transparent;
    }
    canvas {
      background: transparent !important;
    }
    .chart-card {
      background: transparent !important;
      border-radius: 1rem;
      padding: 1.5rem;
    }
  </style>
</head>
<body class="w-screen h-screen">
  <main class="grid grid-cols-1 lg:grid-cols-2 w-full h-full">
    <!-- Globe Section -->
    <div class="relative w-full h-full">
      <div id="globeViz"></div>
      <div id="sliderContainer" class="absolute bottom-6 w-full text-center text-pink-200">
        <span id="monthLabel">January</span><br>
        <input type="range" id="monthSlider" min="0" max="11" step="1" value="0" class="w-3/5 accent-pink-500"><br>
        <button id="playBtn" class="mt-2 bg-pink-600 hover:bg-pink-700 text-white py-1 px-3 rounded-full">▶ Play</button>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="overflow-y-auto p-6 space-y-6">
      <h2 class="text-2xl font-bold text-pink-200">NDVI Trend & Pollinators</h2>

      <div class="chart-card shadow-lg border border-pink-700">
        <h3 class="text-lg font-semibold mb-2 text-pink-300">NDVI Trend</h3>
        <canvas id="ndviChart"></canvas>
      </div>

      <div class="chart-card shadow-lg border border-pink-700">
        <h3 class="text-lg font-semibold mb-2 text-pink-300">Pollinator Activity</h3>
        <canvas id="pollinatorChart"></canvas>
      </div>
    </div>
  </main>

  <script>
    /* ---------------- Globe Setup ---------------- */
    const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    const bloomData = [];
    function addBloom(lat, lng, month, info, count=10, spread=3) {
      for (let i=0; i<count; i++) {
        bloomData.push({
          lat: lat + (Math.random()-0.5)*spread,
          lng: lng + (Math.random()-0.5)*spread,
          month,
          ...info
        });
      }
    }
    // Example NDVI data points
    ["#f48fb1","#f06292","#ec407a","#e91e63","#ad1457","#880e4f","#f48fb1","#f06292","#ec407a","#e91e63","#ad1457","#880e4f"].forEach((color,i)=>{
      addBloom(36.2,138.2,i,{ color,label:"Japan",species:"Cherry Blossom",note:"NDVI + bloom" },12,5);
    });

    // Example Pollinator data points (yellow)
    ["#ffeb3b","#fdd835","#fbc02d","#f9a825","#f57f17","#ffff72","#ffee58","#fdd835","#fbc02d","#f9a825","#f57f17","#ffff72"].forEach((color,i)=>{
      addBloom(-18.9,47.5,i,{ color,label:"Madagascar",species:"Pollinators",note:"Pollinator density" },12,5);
    });

    const GlobeObj = Globe()
      .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
      .backgroundColor('rgba(0,0,0,0)')
      .pointAltitude(d => 0.02 + 0.02*Math.sin(Date.now()*0.005 + d.lat))
      .pointRadius(0.4)
      .pointColor(d => d.color)
      .pointLabel(d => `<b>${d.label}</b><br><i>${d.species}</i><br>${d.note}`);

    const globeElement = document.getElementById('globeViz');
    GlobeObj(globeElement);
    GlobeObj.controls().autoRotate = true;
    GlobeObj.controls().autoRotateSpeed = 0.2;

    const slider = document.getElementById("monthSlider");
    const label = document.getElementById("monthLabel");
    function updateGlobe(monthIndex) {
      label.textContent = monthNames[monthIndex];
      const filtered = bloomData.filter(d => d.month === monthIndex);
      GlobeObj.pointsData(filtered);
    }
    updateGlobe(0);
    slider.addEventListener("input", e => {
      updateGlobe(parseInt(e.target.value));
    });
    (function animate() {
      GlobeObj.pointAltitude(d => 0.02 + 0.02*Math.sin(Date.now()*0.005 + d.lat));
      requestAnimationFrame(animate);
    })();
    let isPlaying = false;
    let playInterval;
    const playBtn = document.getElementById("playBtn");
    playBtn.addEventListener("click", () => {
      if (!isPlaying) {
        isPlaying = true;
        playBtn.textContent = "⏸ Pause";
        playInterval = setInterval(() => {
          let nextMonth = (parseInt(slider.value) + 1) % 12;
          slider.value = nextMonth;
          updateGlobe(nextMonth);
        }, 1000);
      } else {
        isPlaying = false;
        playBtn.textContent = "▶ Play";
        clearInterval(playInterval);
      }
    });

    /* ---------------- Charts ---------------- */
    function generateNDVI() {
      const data = [];
      for (let i=0;i<12;i++) {
        data.push(Math.max(0, Math.min(1, 0.5 + 0.3*Math.sin(i*Math.PI/6) + (Math.random()-0.5)*0.1)));
      }
      return data;
    }
    function generatePollinators() {
      const data = [];
      for (let i=0;i<12;i++) {
        data.push(50 + Math.round(30*Math.sin(i*Math.PI/6) + Math.random()*20));
      }
      return data;
    }

    const ndviCtx = document.getElementById('ndviChart').getContext('2d');
    new Chart(ndviCtx, {
      type: 'line',
      data: {
        labels: monthNames,
        datasets: [{
          label: 'NDVI Index',
          data: generateNDVI(),
          borderColor: '#f06292',
          backgroundColor: 'rgba(240,98,146,0.2)',
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { labels: { color: '#f0a6ca' } } },
        scales: {
          x: { ticks: { color: '#f0a6ca' }, grid: { color: 'rgba(240,166,202,0.2)' } },
          y: { min:0, max:1, ticks: { color: '#f0a6ca' }, grid: { color: 'rgba(240,166,202,0.2)' } }
        }
      }
    });

    const pollCtx = document.getElementById('pollinatorChart').getContext('2d');
    new Chart(pollCtx, {
      type: 'bar',
      data: {
        labels: monthNames,
        datasets: [{
          label: 'Pollinator Count',
          data: generatePollinators(),
          backgroundColor: 'rgba(255, 235, 59, 0.6)',
          borderColor: '#fdd835',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { labels: { color: '#f0a6ca' } } },
        scales: {
          x: { ticks: { color: '#f0a6ca' }, grid: { color: 'rgba(240,166,202,0.2)' } },
          y: { ticks: { color: '#f0a6ca' }, grid: { color: 'rgba(240,166,202,0.2)' } }
        }
      }
    });
  </script>
</body>
</html>
