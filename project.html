<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AstroBloom Globe</title>
  <style>
    body {
      margin: 0;
      background: black;
      font-family: 'Syne', sans-serif;
      overflow: hidden;
    }
    #globeViz {
      width: 100vw;
      height: 100vh;
    }
    #sliderContainer {
      position: absolute;
      bottom: 20px;
      width: 100%;
      text-align: center;
      color: white;
      font-size: 1.2em;
    }
    input[type="range"] {
      width: 60%;
    }
    #playBtn {
      margin-top: 10px;
      padding: 8px 16px;
      font-size: 1em;
      cursor: pointer;
      border-radius: 8px;
      border: none;
    }
  </style>
</head>
<body>
  <div id="globeViz"></div>

  <div id="sliderContainer">
    <span id="monthLabel">January</span><br>
    <input type="range" id="monthSlider" min="0" max="11" step="1" value="0"><br>
    <button id="playBtn">▶ Play</button>
  </div>

  <script src="https://unpkg.com/three"></script>
  <script src="https://unpkg.com/globe.gl"></script>

  <script>
    const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];

    const bloomData = [];

    // Helper to add bloom points
    function addBloom(lat, lng, month, color, label, species, note, count=10, spread=3) {
      for (let i = 0; i < count; i++) {
        bloomData.push({
          lat: lat + (Math.random()-0.5)*spread,
          lng: lng + (Math.random()-0.5)*spread,
          month,
          color,
          label,
          species,
          note
        });
      }
    }

    // Example: Japan cherry blossoms
    ["#f484d4ff","#e647b9ff","#ab8aecff","#d56de3ff","#e898ecff","#f399f0ff","#de4242ff","#c27d37ff","#e16473ff","#f1ebb2ff","#f5a2acff","#e8eb49ff"]
      .forEach((color, i) => {
        addBloom(36.2, 138.2, i, color, "Japan", "Cherry Blossom - Sakura", "Cultural symbol; peak bloom in spring");
      });

    // Initialize globe
    const GlobeObj = Globe()
      .globeImageUrl('//unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
      .pointAltitude(d => 0.02 + 0.02*Math.sin(Date.now()*0.005 + d.lat))
      .pointRadius(0.4)
      .pointColor(d => d.color)
      .pointLabel(d => `<b>${d.label}</b><br><i>${d.species}</i><br>${d.note}`);

    GlobeObj(document.getElementById('globeViz'));

    // Auto-rotate slower
    GlobeObj.controls().autoRotate = true;
    GlobeObj.controls().autoRotateSpeed = 0.2;

    const slider = document.getElementById("monthSlider");
    const label = document.getElementById("monthLabel");

    function updateGlobe(monthIndex) {
      label.textContent = monthNames[monthIndex];
      const filtered = bloomData.filter(d => d.month === monthIndex);
      GlobeObj.pointsData(filtered);
    }

    updateGlobe(0);

    slider.addEventListener("input", e => {
      updateGlobe(parseInt(e.target.value));
    });

    // Pulsing animation
    (function animate() {
      GlobeObj.pointAltitude(d => 0.02 + 0.02*Math.sin(Date.now()*0.005 + d.lat));
      requestAnimationFrame(animate);
    })();

    // Play button
    let isPlaying = false;
    let playInterval;
    const playBtn = document.getElementById("playBtn");

    playBtn.addEventListener("click", () => {
      if (!isPlaying) {
        isPlaying = true;
        playBtn.textContent = "⏸ Pause";
        playInterval = setInterval(() => {
          let nextMonth = (parseInt(slider.value) + 1) % 12;
          slider.value = nextMonth;
          updateGlobe(nextMonth);
        }, 1000);
      } else {
        isPlaying = false;
        playBtn.textContent = "▶ Play";
        clearInterval(playInterval);
      }
    });
  </script>
</body>
</html>
